{% extends "base.html" %}
{% block title %}ä¸Šå‚³æ–‡ä»¶{% endblock %}
{% block content %}

<h2 class="my-3">ä¸Šå‚³ PDF</h2>

<form id="upload-form" action="{% url 'upload' %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <div id="drop-zone" class="drop-zone">
        <p>æ‹–æ›³ PDF åˆ°æ­¤è™•ï¼Œæˆ– <span id="file-select">é»æ“Šé¸æ“‡æª”æ¡ˆ</span></p>
        <input type="file" id="file-input" name="pdf_file" accept="application/pdf" required hidden>
    </div>

    <div id="preview" class="preview mt-3" style="display: none;">
        <p class="fw-bold text-primary">ğŸ“ æº–å‚™ä¸Šå‚³ï¼š<span id="file-name"></span></p>
        <embed id="pdf-preview" type="application/pdf" width="100%" height="500px" />
    </div>

    <div class="mt-3 text-end">
        <button type="submit" class="btn btn-primary px-4">ç¢ºå®šä¸Šå‚³</button>
    </div>
</form>

<hr class="my-5">

{% if uploaded_file_url %}
    <div class="alert alert-success d-flex align-items-center justify-content-between">
        <div>
            <h4 class="alert-heading mb-1">âœ… ä¸Šå‚³æˆåŠŸï¼</h4>
            <p class="mb-0">
                æª”æ¡ˆå·²å„²å­˜ï¼Œæ‚¨å¯ä»¥
                <a href="{{ uploaded_file_url }}" target="_blank" class="fw-bold text-decoration-underline">æª¢è¦–æ–‡ä»¶</a>
            </p>
        </div>
        <a href="{{ uploaded_file_url }}" target="_blank" class="btn btn-success">
            æª¢è¦–æ–‡ä»¶
        </a>
    </div>

    <h4 class="mt-4">ğŸ“„ æª”æ¡ˆé è¦½</h4>
    <div class="border p-2 rounded">
        <object data="{{ uploaded_file_url }}" type="application/pdf" width="100%" height="800px">
            <p>ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´ PDF é è¦½ï¼Œè«‹ <a href="{{ uploaded_file_url }}" class="btn btn-sm btn-outline-primary">é»æ­¤ä¸‹è¼‰</a>ã€‚</p>
        </object>
    </div>
{% endif %}

<style>
    /* æ‹–æ›³å€åŸŸæ¨£å¼ */
    .drop-zone {
        border: 2px dashed #aaa;
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        background-color: #f9f9f9;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .drop-zone:hover {
        background-color: #f1f1f1;
        border-color: #666;
    }

    .drop-zone.dragover {
        background-color: #e0f0ff;
        border-color: #007bff;
        transform: scale(1.01);
    }

    .drop-zone p {
        font-size: 1.2rem;
        color: #666;
        margin: 0;
        pointer-events: none;
    }

    .drop-zone span {
        color: #007bff;
        text-decoration: underline;
        pointer-events: auto;
    }

    /* é è¦½å€åŸŸæ¨£å¼ */
    .preview embed {
        border: 1px solid #ccc;
        border-radius: 6px;
        background-color: #fff;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const fileSelect = document.getElementById('file-select');
        const preview = document.getElementById('preview');
        const fileNameDisplay = document.getElementById('file-name');
        const pdfPreview = document.getElementById('pdf-preview');

        // é¡¯ç¤ºé è¦½å‡½å¼
        function showPreview(file) {
            fileNameDisplay.textContent = file.name;
            const fileURL = URL.createObjectURL(file);
            pdfPreview.src = fileURL;
            preview.style.display = 'block';
        }

        fileSelect.addEventListener('click', (e) => {
            e.stopPropagation();
            fileInput.click();
        });

        dropZone.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', () => {
            const file = fileInput.files[0];
            if (file && file.type === 'application/pdf') {
                showPreview(file);
            } else if (file) {
                alert("æ ¼å¼éŒ¯èª¤ï¼šè«‹é¸æ“‡ PDF æª”æ¡ˆï¼");
                fileInput.value = '';
                preview.style.display = 'none';
            }
        });

        dropZone.addEventListener('dragover', e => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', e => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type === 'application/pdf') {
                    fileInput.files = files;
                    showPreview(file);
                } else {
                    alert("åƒ…æ”¯æ´ PDF æª”æ¡ˆï¼");
                }
            }
        });
    });
</script>

{% endblock %}